<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ZAGE - ì„±ì¸ì¸ì¦ ë°ëª¨</title>
    <script src="wasm_exec.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .box { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #status { margin-top: 10px; font-weight: bold; color: green; }
        #proofResult { word-break: break-all; background: #f0f0f0; padding: 10px; font-family: monospace; font-size: 12px; display: none;}
    </style>
</head>
<body>
    <h1>ğŸ”’ ZAGE: ì˜ì§€ì‹ ì„±ì¸ì¸ì¦</h1>
    <p>ì„œë²„ì— ë‚´ ìƒë…„ì›”ì¼ì„ ë³´ë‚´ì§€ ì•Šê³ , ì„±ì¸ì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.</p>

    <div class="box">
        <h3>1. ì •ë³´ ì…ë ¥ (ë¸Œë¼ìš°ì € ë‚´ë¶€ì—ì„œë§Œ ì²˜ë¦¬ë¨)</h3>
        <label>íƒœì–´ë‚œ ì—°ë„: </label>
        <input type="number" id="birthYear" value="2000" placeholder="ì˜ˆ: 2005">
        <br><br>
        <button onclick="runZKP()">ğŸ›¡ï¸ ì¦ëª…ì„œ ìƒì„±í•˜ê¸°</button>
        <div id="status"></div>
    </div>

    <div class="box" id="proofBox" style="display:none;">
        <h3>2. ìƒì„±ëœ ì˜ì§€ì‹ ì¦ëª… (Proof)</h3>
        <p>ì´ ì•”í˜¸ë¬¸ë§Œ ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤. (ìƒë…„ì›”ì¼ X)</p>
        <div id="proofResult"></div>
    </div>

    <script>
        // 1. Go Wasm ë¡œë”©í•˜ê¸°
        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
            go.run(result.instance);
            console.log("Wasm Loaded!");
            document.getElementById("status").innerText = "ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ (Wasm Loaded)";
        });

        // 2. ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        function runZKP() {
            const birth = document.getElementById("birthYear").value;
            const currentYear = 2025;
            const limitAge = 19;

            document.getElementById("status").innerText = "â³ ì¦ëª… ìƒì„± ì¤‘... (ì—„ì²­ë‚œ ìˆ˜í•™ ê³„ì‚° ì¤‘)";
            document.getElementById("status").style.color = "orange";

            // ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì£¼ì–´ UIê°€ ë©ˆì¶”ì§€ ì•Šê²Œ í•¨
            setTimeout(() => {
                // Go í•¨ìˆ˜ í˜¸ì¶œ! (verifyAgeZKP)
                // Go ì½”ë“œì—ì„œ js.Global().Set("verifyAgeZKP", ...) í–ˆë˜ ê·¸ ì´ë¦„ì…ë‹ˆë‹¤.
                const proof = verifyAgeZKP(currentYear, limitAge, parseInt(birth));

                if (proof.startsWith("Error")) {
                    alert(proof);
                    document.getElementById("status").innerText = "âŒ ì‹¤íŒ¨";
                } else {
                    document.getElementById("status").innerText = "âœ… ì¦ëª… ìƒì„± ì„±ê³µ!";
                    document.getElementById("status").style.color = "green";
                    
                    document.getElementById("proofBox").style.display = "block";
                    document.getElementById("proofResult").style.display = "block";
                    document.getElementById("proofResult").innerText = proof;
                    
                    alert("ì„±ê³µ! ì´ ê¸´ ì•”í˜¸ë¬¸ì´ ë°”ë¡œ 'ì„±ì¸ì´ë¼ëŠ” ì¦ê±°'ì…ë‹ˆë‹¤.");
                }
            }, 100);
        }
    </script>
</body>
</html>